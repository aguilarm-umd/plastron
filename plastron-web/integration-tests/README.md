# Manual Integration Tests for STOMP Commands

## Prerequisites

* a running fcrepo Docker stack
* a running [umd-handle] application

### Required Configuration

_fcrepo-local.yml_

```yaml
REPOSITORY:
  REST_ENDPOINT: http://fcrepo-local:8080/fcrepo/rest
  RELPATH: /
  AUTH_TOKEN: ... # JWT token generated from http://fcrepo-local:8080/fcrepo/user
  LOG_DIR: logs
  STRUCTURE: hierarchical
PUBLICATION_WORKFLOW:
  HANDLE_ENDPOINT: http://handle-local:3000/api/v1
  HANDLE_JWT_TOKEN: ... # JWT token generated by running "rails 'jwt:create_token[plastrond-http]'" in the umd-handle application directory
  HANDLE_PREFIX: 1903.1
  HANDLE_REPO: fcrepo
  PUBLIC_URL_PATTERN: http://digital-local/{uuid}
```

## Steps

1. Create a new resource in the repository:
   ```bash
   plastron -c fcrepo-local.yml create -T pcdm:Object
   ```
2. Export the URI value in bash:
   ```bash
   export URI={value copied from create command output}
   ```
3. Start up the Plastron HTTP daemon:
   ```bash
   python -m plastron.web.server -c fcrepo-local.yml
   ```
4. Change into the integration-tests directory from the main Plastron
   project directory:
   ```bash
   cd plastron-web/integration-tests
   ```
5. Enable the integration tests:
   ```bash
   export INTEGRATION_TESTS=1
   ```
6. Submit the "Publish" message:
   ```bash
   pytest test_publish_http.py
   ```
7. Confirm that the item now has an `rdf:type` of `umdaccess:Published`.
8. Submit the "Unpublish" message:
   ```bash
   pytest test_unpublish_http.py
   ```
9. Confirm that the item now does *not* have an `rdf:type` of
   `umdaccess:Published`.
10. Submit the "PublishHidden" message:
    ```bash
    pytest test_publish_hidden_http.py
    ```
11. Confirm that the item now has both the `rdf:type` of
    `umdaccess:Published` and `umdaccess:Hidden`.

[umd-handle]: https://github.com/umd-lib/umd-handle